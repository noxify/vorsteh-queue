---
title: Kysely Adapter
navTitle: "@vorsteh-queue/adapter-kysely"
description: Kysely adapter for PostgreSQL providing type-safe database operations with excellent performance.
---

The Kysely adapter provides PostgreSQL support using Kysely, offering excellent TypeScript integration and performance.

## Installation

<Command variant="install">@vorsteh-queue/core @vorsteh-queue/adapter-kysely</Command>

## Quick Start

```typescript
import { Kysely } from "kysely"
import { PostgresJSDialect } from "kysely-postgres-js"
import postgres from "postgres"

import type { QueueJobTableDefinition } from "@vorsteh-queue/adapter-kysely/types"
import { PostgresQueueAdapter } from "@vorsteh-queue/adapter-kysely"
import { Queue } from "@vorsteh-queue/core"

interface DB {
  queue_jobs: QueueJobTableDefinition
  other_table: {
    name: string
  }
}

// Shared database connection
const client = postgres(
  process.env.DATABASE_URL || "postgresql://postgres:password@localhost:5432/queue_db",
  { max: 10 }, // Connection pool
)

const db = new Kysely<DB>({
  dialect: new PostgresJSDialect({
    postgres: client,
  }),
})

const adapter = new PostgresQueueAdapter(db)
const queue = new Queue(adapter)
```

## Supported providers

- PGlite - https://github.com/czeidler/kysely-pglite-dialect
- Postgres.JS - https://github.com/kysely-org/kysely-postgres-js
- Node Progress - https://kysely-org.github.io/kysely-apidoc/classes/PostgresDialect.html

## Database Setup

### Schema

The adapter includes a pre-defined migration:

```typescript path="migrations/queue-jobs.ts"
export { down, up } from "@vorsteh-queue/adapter-kysely/migrations"
```

If you don't want to use the pre-defined schema, you can create your own migration.

<RemoteCodeBlock
  source="./packages/adapter-kysely/src/migrations/queue_table.ts"
  language="ts"
  showToolbar={true}
  path="/migrations/queue-jobs.ts"
/>

### Custom Table & Schema Names

To create a table with custom name and schema, you can use the `createQueueJobsTable` helper, which will create the table without taking care about the field definitions:

```typescript path="migrations/queue-jobs.ts"
import { createQueueJobsTable } from "@vorsteh-queue/adapter-kysely"

export const { up, down } = createQueueJobsTable(
  // your custom table name
  "custom_queue_jobs",
  // your custom schema name
  "custom_schema",
)
```

To use the custom table and schema in the adapter, pass the adapter configuration to the `PostgresQueueAdapter`:

```typescript
import { Kysely } from "kysely"

import type { QueueJobTableDefinition } from "@vorsteh-queue/adapter-kysely/types"
import { PostgresQueueAdapter } from "@vorsteh-queue/adapter-kysely"

interface DB {
  custom_queue_jobs: QueueJobTableDefinition
}

const db = new Kysely<DB>({
  //... your Kysely configuration
})

const adapter = new PostgresQueueAdapter(db, {
  // Your custom schema name
  schemaName: "custom_schema",
  // Your custom table name
  tableName: "custom_queue_jobs",
})
```

<Note title="Want to see it in action?">
  Checkout our kysely example with [custom schema and
  table](/docs/examples/kysely-custom-schema-table/).
</Note>

### Migration

To run the migrations, we recommend to use [`kysely-ctl`](https://github.com/kysely-org/kysely-ctl).

> `kysely-ctl` is the command-line tool for Kysely.

## References

- Sources: https://github.com/noxify/vorsteh-queue/tree/main/packages/adapter-kysely
- NPM: https://www.npmjs.com/package/@vorsteh-queue/adapter-kysely
